<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GATE 2026 Mock Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
    --bg: #f4f7f6;
    --header: #2c3e50;
    --accent: #3498db;
    --good: #e7f9ef;
    --bad: #fceaea;
    --green: #27ae60;
    --red: #e74c3c;
}

body {
    font-family: 'Segoe UI', sans-serif;
    background: var(--bg);
    margin: 0;
    padding: 20px;
}

h1 { margin: 0; color: var(--header); }

header {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    margin-bottom: 15px;
}

button {
    padding: 8px 14px;
    border: none;
    border-radius: 5px;
    color: white;
    cursor: pointer;
}

.btn-download { background: var(--green); }
.btn-reset { background: var(--red); }

.summary {
    background: white;
    padding: 14px;
    border-radius: 8px;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 15px;
}

.metric span {
    font-size: 12px;
    color: #666;
}

.metric div {
    font-size: 16px;
    font-weight: 600;
}

.progress {
    flex: 1;
    min-width: 200px;
}

.progress-bar {
    height: 12px;
    background: #ddd;
    border-radius: 50px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    width: 0%;
    background: var(--accent);
}

.table-wrap {
    overflow-x: auto;
    background: white;
    border-radius: 8px;
}

table {
    width: 100%;
    min-width: 1400px;
    border-collapse: collapse;
}

th, td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    font-size: 14px;
}

th {
    background: var(--header);
    color: white;
    position: sticky;
    top: 0;
}

input, textarea, select {
    width: 100%;
    padding: 6px;
    font-size: 13px;
}

textarea { resize: vertical; }

.row-good { background: var(--good); }
.row-bad { background: var(--bad); }

.status-done { color: var(--green); font-weight: bold; }
.status-pending { color: var(--red); font-weight: bold; }
</style>
</head>

<body>

<header>
    <h1>GATE 2026 Mock Tracker</h1>
    <div>
        <button class="btn-download" onclick="downloadCSV()">Download CSV</button>
        <button class="btn-reset" onclick="resetData()">Reset</button>
    </div>
</header>

<div class="summary">
    <div class="metric">
        <span>Mocks Done</span>
        <div id="doneMetric">0 / 0</div>
    </div>
    <div class="metric">
        <span>Avg Accuracy</span>
        <div id="avgAccuracy">-</div>
    </div>
    <div class="metric">
        <span>Best Accuracy</span>
        <div id="bestAccuracy">-</div>
    </div>
    <div class="progress">
        <span id="progressLabel">Progress: 0%</span>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>
</div>

<div class="table-wrap">
<table>
<thead>
<tr>
<th>Date</th>
<th>Mock</th>
<th>Correct</th>
<th>Wrong</th>
<th>Attempted</th>
<th>Accuracy %</th>
<th>Wrong Topics</th>
<th>Error Type</th>
<th>Unattempted Topics</th>
<th>Reason</th>
<th>Action Plan</th>
<th>Status</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<script>
const STORAGE_KEY = "gate_mock_tracker_accuracy_v1";
const TOTAL_MOCKS = 21;
const START_DATE = new Date(2025, 8, 1); // Sept 1, 2025

let tableData = [];

/* ---------- INIT ---------- */
function init() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
        tableData = JSON.parse(saved).data;
    } else {
        tableData = generateSchedule();
        persist();
    }
    render();
}

/* ---------- DATA ---------- */
function generateSchedule() {
    let data = [];
    let date = new Date(START_DATE);
    let count = 1;

    while (count <= TOTAL_MOCKS) {
        if ([2,4,6].includes(date.getDay())) {
            data.push({
                date: date.toISOString().split('T')[0],
                day: date.toLocaleDateString('en-US', { weekday: 'short' }),
                mock: `Mock ${count}`,
                correct: "",
                wrong: "",
                attempted: "",
                accuracy: "",
                wrongTopics: "",
                errorType: "",
                unattempted: "",
                reason: "",
                action: "",
                status: "Pending"
            });
            count++;
        }
        date.setDate(date.getDate() + 1);
    }
    return data;
}

function persist() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
        version: 3,
        data: tableData
    }));
}

/* ---------- RENDER ---------- */
function render() {
    const avgAcc = getAverageAccuracy();
    const tbody = document.getElementById("tableBody");
    tbody.innerHTML = "";

    tableData.forEach((r, i) => {
        const acc = parseFloat(r.accuracy);
        const tr = document.createElement("tr");

        if (!isNaN(acc) && avgAcc !== null) {
            acc >= avgAcc ? tr.classList.add("row-good") : tr.classList.add("row-bad");
        }

        tr.innerHTML = `
<td>
<input type="date" value="${r.date}" onchange="update(${i},'date',this.value)">
<br><small>${r.day}</small>
</td>
<td><b>${r.mock}</b></td>
<td><input type="number" min="0" value="${r.correct}" onchange="update(${i},'correct',this.value)"></td>
<td><input type="number" min="0" value="${r.wrong}" onchange="update(${i},'wrong',this.value)"></td>
<td>${r.attempted || "-"}</td>
<td>${r.accuracy || "-"}</td>
<td><textarea onchange="update(${i},'wrongTopics',this.value)">${r.wrongTopics}</textarea></td>
<td>
<select onchange="update(${i},'errorType',this.value)">
<option value="">-</option>
<option ${r.errorType==="Concept"?"selected":""}>Concept</option>
<option ${r.errorType==="Calc"?"selected":""}>Calc</option>
<option ${r.errorType==="Guess"?"selected":""}>Guess</option>
<option ${r.errorType==="Silly"?"selected":""}>Silly</option>
</select>
</td>
<td><textarea onchange="update(${i},'unattempted',this.value)">${r.unattempted}</textarea></td>
<td>
<select onchange="update(${i},'reason',this.value)">
<option value="">-</option>
<option ${r.reason==="Time"?"selected":""}>Time</option>
<option ${r.reason==="Forgot"?"selected":""}>Forgot</option>
<option ${r.reason==="Skip"?"selected":""}>Skip</option>
</select>
</td>
<td><textarea onchange="update(${i},'action',this.value)">${r.action}</textarea></td>
<td class="${r.status==='Done'?'status-done':'status-pending'}">${r.status}</td>
`;
        tbody.appendChild(tr);
    });

    updateSummary();
}

/* ---------- UPDATE ---------- */
function update(i, field, value) {
    tableData[i][field] = value;

    const c = parseInt(tableData[i].correct);
    const w = parseInt(tableData[i].wrong);

    if (!isNaN(c) || !isNaN(w)) {
        const correct = isNaN(c) ? 0 : c;
        const wrong = isNaN(w) ? 0 : w;
        const attempted = correct + wrong;

        tableData[i].attempted = attempted || "";

        if (attempted > 0) {
            tableData[i].accuracy = ((correct / attempted) * 100).toFixed(1);
            tableData[i].status = "Done";
        } else {
            tableData[i].accuracy = "";
            tableData[i].status = "Pending";
        }
    }

    if (field === "date") {
        const d = new Date(value);
        tableData[i].day = d.toLocaleDateString('en-US', { weekday: 'short' });
    }

    persist();
    render();
}

/* ---------- SUMMARY ---------- */
function getAverageAccuracy() {
    const arr = tableData.map(r => parseFloat(r.accuracy)).filter(v => !isNaN(v));
    if (!arr.length) return null;
    return arr.reduce((a,b)=>a+b,0) / arr.length;
}

function updateSummary() {
    const total = tableData.length;
    const done = tableData.filter(r => r.status === "Done").length;
    const accs = tableData.map(r => parseFloat(r.accuracy)).filter(v => !isNaN(v));

    document.getElementById("doneMetric").innerText = `${done} / ${total}`;
    document.getElementById("avgAccuracy").innerText =
        accs.length ? (accs.reduce((a,b)=>a+b,0)/accs.length).toFixed(1)+"%" : "-";
    document.getElementById("bestAccuracy").innerText =
        accs.length ? Math.max(...accs).toFixed(1)+"%" : "-";

    const p = Math.round((done/total)*100);
    document.getElementById("progressLabel").innerText = `Progress: ${p}%`;
    document.getElementById("progressFill").style.width = p+"%";
}

/* ---------- CSV ---------- */
function downloadCSV() {
    let csv = "Date,Mock,Correct,Wrong,Attempted,Accuracy,Status\n";
    tableData.forEach(r => {
        csv += `${r.date},${r.mock},${r.correct},${r.wrong},${r.attempted},${r.accuracy},${r.status}\n`;
    });
    const a = document.createElement("a");
    a.href = encodeURI("data:text/csv;charset=utf-8," + csv);
    a.download = "GATE_Mock_Tracker.csv";
    a.click();
}

/* ---------- RESET ---------- */
function resetData() {
    if (confirm("Delete all progress?")) {
        localStorage.removeItem(STORAGE_KEY);
        location.reload();
    }
}

init();
</script>

</body>
</html>
